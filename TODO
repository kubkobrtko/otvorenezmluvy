Nejake moje poznamky ako to spravit:

- pouzit scroll/scan po definovani heuristiky na update matchujucich zmluv. http://www.elasticsearch.org/guide/reference/api/search/scroll.html + resque lebo to potrva
- pouzit perkolator na zaregistrovanie heuristik a rovno update po ulozeni (asi treba 2x update, ale prezijeme) http://www.elasticsearch.org/guide/reference/api/percolate.html
- perkolator pri ukladani vrati akym query/heuristikam dok vyhovuje, cize nove dokumenty netreba riesit, tie sa updatnu same.
- pri ukladani ulozit sumu papriciek ako stlpec do ES. bude sa dat podla toho sortovat.

- samostatne treba asi riesit chybajuce hodnoty (vo fazetach to vracia ako missing)

- spravit index na strany a ked sa vyhladava fulltextovo a mame tam match v obsahu tak treba zozbierat idecka pustit query aj nad stranami, tie potom prigroupovat k zmluvam vo vysledkoch
  ako to ma documentcloud

- je otazne nakolko potrebujeme autocomplete na fazety ako supplier/customer. da sa to totiz dat priamo do query a supplier, customer, maju velky boost. taktiez sa da spravit query supplier:ibm
  ale to je trochu nesikovne
- autocomplete na siroke fazety (napriklad firmy). Priamo sa to neda, kedze to je podtyp, ale mozeme spravit query na dokumenty vyhovujuce document.supplier a vypytat si tu fazetu.
  resp. dali by sa aj vsetky, ale neviem ci by to moc neskakalo.
- intelignentne fazety - ak ma fazeta do 20 itemov, zobrazit 10 a zvysok cez nejake rozbalovatko. Ak ich je viac, tak tam treba autocomplete.


mapovanie je v es-mapping.json - analyzer je eulang (vyhadzuje diakritiku) a definovany na nimbuse v configu ako:
index:
  analysis:
    analyzer:
      eulang:
        type: custom
        tokenizer: standard
        filter: [standard, lowercase, asciifolding, stop]

- stlpce so stringami su definova vzdy dvojmo cez multi_field. jeden sluzi na vyhladavanie, untouched na fazety.


- fazety nemusia vediet svoje mena to im staci poslat z factic triedy, taktiez niektore fazety nebudu asi priamo vlavo (napriklad statisticka co rata celkovu sumu zmluv pre restrikciu)
- v pohlade chcem si vypytat hash naplnenych faziet
- naplnena fazeta ma
    - parametre na vypnutie restrikcie, nazov restrikcie
    - zoznam itemov kde kazdy ma meno + count + parametre na search + ci je aktivna
    - pocet missing

- fazeta moze do searchu hodit aj viac definicii es faziet (napriklad na zistenie aj sum) preto sa to deje nepriamo cez add_facet_definitions

- paginate vysledkov
- zvazit ci pouzit tire na ES od karmiho. Je to dost zive a moc sa mi nepacia tie definicie, lebo sa s tym neda moc hybat.

- keby nebolo jasne co je rozdiel medzi query a filtrom (lebo mne to trvalo) - je v tom, ze query robi scoring a teda je pomalsi, a pre fulltext to je nutne. Ale nie je to nic hrozne.

- neskor bude treba pravdepodobne zduplikovat v modeloch stlpce, ktore sa budu precistovat cez regis alebo nejake slovniky. len ibm tam je 4 sposobmi http://localhost:3000/?utf8=%E2%9C%93&query=supplier%3Aibm
